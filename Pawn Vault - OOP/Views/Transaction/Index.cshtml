@{
    ViewData["Title"] = "Transactions";
}

<div class="p-5">
    <!-- Header -->
    <div class="flex justify-between items-center mb-5 relative">
        <h2 class="flex items-center text-2xl font-bold">
            <span class="w-1 h-7 bg-[#D4AF37] mr-2"></span>Transactions
        </h2>

        <a asp-action="Create" class="flex items-center gap-1.5 text-sm font-bold px-4 py-2 cursor-pointer rounded-lg bg-[#002B5B] text-gray-100 hover:bg-[#003c7c] transition">
            <i class="fas fa-plus text-xl leading-none"></i> Add Transaction
        </a>
    </div>

    <!-- Scrollable Table -->
    <div class="bg-transparent py-2 mt-4 max-h-[400px] rounded-lg">
        <table class="w-full border-separate border-spacing-y-3 mt-4">
            <thead class="bg-gray-100 text-[#002B5B] sticky top-0 z-20">
                <tr>
                    <th class="text-left font-bold p-2">Transaction ID</th>
                    <th class="text-left font-bold p-2">Date</th>
                    <th class="text-left font-bold p-2">Type</th>
                    <th class="text-left font-bold p-2">Customer</th>
                    <th class="text-left font-bold p-2">Item</th>
                    <th class="text-left font-bold p-2">Amount</th>
                    <th class="text-left font-bold p-2">Status</th>
                    <th class="text-left font-bold p-2">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr class="bg-white rounded-xl shadow-md hover:bg-[#f1f6ff] transition">
                    <td class="p-3 text-sm rounded-lg">TRX-001</td>
                    <td class="p-3 text-sm rounded-lg">2024-03-20</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">Pawn</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg">John Doe</td>
                    <td class="p-3 text-sm rounded-lg">Gold Ring</td>
                    <td class="p-3 text-sm rounded-lg">$500.00</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Active</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg relative">
                        <button class="text-gray-500 hover:text-gray-700 focus:outline-none" onclick="toggleMenu('menu-TRX-001')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div id="menu-TRX-001" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
                            <a asp-action="ViewTransaction" asp-route-id="TRX-001" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-eye mr-2"></i>View
                            </a>
                            <a asp-action="EditTransaction" asp-route-id="TRX-001" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </a>
                            <button onclick="deleteTransaction('TRX-001')" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                <i class="fas fa-trash-alt mr-2"></i>Delete
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="bg-white rounded-xl shadow-md hover:bg-[#f1f6ff] transition">
                    <td class="p-3 text-sm rounded-lg">TRX-002</td>
                    <td class="p-3 text-sm rounded-lg">2024-03-19</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Redeem</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg">Jane Smith</td>
                    <td class="p-3 text-sm rounded-lg">Diamond Necklace</td>
                    <td class="p-3 text-sm rounded-lg">$1,200.00</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">Completed</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg relative">
                        <button class="text-gray-500 hover:text-gray-700 focus:outline-none" onclick="toggleMenu('menu-TRX-002')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div id="menu-TRX-002" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
                            <a asp-action="ViewTransaction" asp-route-id="TRX-002" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-eye mr-2"></i>View
                            </a>
                            <a asp-action="EditTransaction" asp-route-id="TRX-002" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </a>
                            <button onclick="deleteTransaction('TRX-002')" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                <i class="fas fa-trash-alt mr-2"></i>Delete
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="bg-white rounded-xl shadow-md hover:bg-[#f1f6ff] transition">
                    <td class="p-3 text-sm rounded-lg">TRX-003</td>
                    <td class="p-3 text-sm rounded-lg">2024-03-18</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Forfeit</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg">Mike Johnson</td>
                    <td class="p-3 text-sm rounded-lg">Watch</td>
                    <td class="p-3 text-sm rounded-lg">$800.00</td>
                    <td class="p-3 text-sm rounded-lg">
                        <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">Completed</span>
                    </td>
                    <td class="p-3 text-sm rounded-lg relative">
                        <button class="text-gray-500 hover:text-gray-700 focus:outline-none" onclick="toggleMenu('menu-TRX-003')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div id="menu-TRX-003" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
                            <a asp-action="ViewTransaction" asp-route-id="TRX-003" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-eye mr-2"></i>View
                            </a>
                            <a asp-action="EditTransaction" asp-route-id="TRX-003" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </a>
                            <button onclick="deleteTransaction('TRX-003')" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                <i class="fas fa-trash-alt mr-2"></i>Delete
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

@{
    ViewData["Message"] = "Are you sure you want to delete this transaction? This action cannot be undone.";
    ViewData["DeleteUrl"] = "/Transaction/Delete/";
    ViewData["ModalId"] = "deleteModal";
}
@await Html.PartialAsync("_DeleteModal")

@section Scripts {
    <script>
        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('[id^="menu-"]');
            
            // Close all other menus
            allMenus.forEach(m => {
                if (m.id !== menuId) {
                    m.classList.add('hidden');
                }
            });
            
            // Toggle the clicked menu
            menu.classList.toggle('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            const menus = document.querySelectorAll('[id^="menu-"]');
            const isClickInsideMenu = Array.from(menus).some(menu => menu.contains(event.target));
            const isClickOnButton = event.target.closest('button');
            
            if (!isClickInsideMenu && !isClickOnButton) {
                menus.forEach(menu => menu.classList.add('hidden'));
            }
        });

        function deleteTransaction(transactionId) {
            const deleteUrl = `/Transaction/Delete/${transactionId}`;
            document.querySelector('#deleteModal button[onclick^="confirmDelete"]').setAttribute('onclick', `confirmDelete('${deleteUrl}')`);
            showDeleteModal('deleteModal');
        }
    </script>
}
